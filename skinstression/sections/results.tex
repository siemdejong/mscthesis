\section{Results}

\begin{figure}
    \centering
    \includegraphics[width=\linewidth]{skinstression/images/truncated-and-interpolated-curves.pdf}
    \caption[Truncated and spline interpolated curves]{
        The strain-stress curves (black) were truncated and interpolated (dotted red)
        using non-uniform, interpolating splines on the stretch values of the curve with the lowest maximum stretch.
    }
    \label{fig:trunc_interp_curves}
\end{figure}

\subsection{Participants}\label{subsec:results_participants}

Earlier studies \sidecite{Haasterecht2023, Zhou2023, Soylu2022} include 18 individuals (5 men, 4 women, and 6 unknown).
Abdomen data was excluded, because the strain-stress curves differ significantly from the thigh.
All thigh data is included, which is different from the original study, where only the 48 latest samples were used.
These considerations result in data including 15 individuals (5 men, 4 women, 3 unknown).
Ages range from 61 to 94.
From every skin tissue piece, measured strain-stress curves are shown in \cref{fig:trunc_interp_curves}.
The number of measured strain-stress curves range from 1 to 13.
The source of data is summarized in \cref{fig:source_of_data}.

\begin{marginfigure}
    \centering
    \includegraphics[width=\linewidth]{skinstression/images/age_distribution.pdf}
    \caption[Source of data]{
        The selected individuals and their sex, age and number of strain-stress curves.
        Bubble size and centered text show number of curves.
    }
    \label{fig:source_of_data}
\end{marginfigure}

\subsection{Predictor pre-selection}

\begin{marginfigure}
    \centering
    \includegraphics[width=\linewidth]{skinstression/images/exp-fits/exponential.png}
    \caption[Exponential fit]{
        Exponential fit with \cref{eq:exp} (red) for one stress-strain curve (black).
        Fit parameters were $G_0=\qty{23.8\pm4.0}{\mega\pascal\per\stretch}$, and $\lambda=\qty{4.1\pm 1.0}{\stretch}$.
        $R^2=\num{0.9497}$.
    }
    \label{fig:exp_fits}
\end{marginfigure}

\subsubsection{Exponential}
An exponential fit to \cref{eq:exp} is shown in \cref{fig:exp_fits}.
$R^2 = \num{0.9497}$.
The exponent is not able to fit the plateau that is often exhibited near maximum stretch.


\subsubsection{PCA}
The PCA fit for every truncated and interpolated strain-stress curve is depicted in \cref{fig:pca_fits}.
An example is shown in \cref{fig:pca-fit-and-r2-histogram}.
For every fit, $R^2$ is calculated with respect to the interpolated and truncated data.
On average, $\overline{R^2} \approx \num{0.9926}$ (SE \num{0.0003}).
Due to the nature of PCA, the exponential part of the curves that rise later is not included in the making of the fit.

\begin{figure}
    \centering
    \includegraphics[width=0.45\linewidth]{skinstression/images/pca-fits/sample_6.pdf}
    \includegraphics[width=0.45\linewidth]{skinstression/images/pca-fits/r2_hist.pdf}
    \caption[Logistic curve fits to stress-strain curves]{
        Top panel: PCA fit (red) to one stress-strain curve (black).
        $R^2 = 0.993$.
        Bottom panel: distribution of $R^2$ on all stress-strain curves.
        Mean $R^2 = 0.9927$ (red) with a standard deviation of \num{0.0022}.
    }
    \label{fig:pca-fit-and-r2-histogram}
\end{figure}


\subsubsection{Logistic curve}
The logistic curve fit for every strain-stress curve is shown in \cref{fig:logistic_fits}.
An example is shown in \cref{fig:logistic-fit-and-r2-histogram}.
For every fit, $R^2$ is calculated.
On average, $\overline{R^2} \approx \num{0.9984}$ (SE \num{0.0002}).
Because the logistic curve describes the stress-strain data more accurate than PCA or the exponential, it will be used from now on.

\begin{figure}
    \centering
    \includegraphics[width=0.45\linewidth]{skinstression/images/logistic-fits/sample_6.pdf}
    \includegraphics[width=0.45\linewidth]{skinstression/images/logistic-fits/r2_hist.pdf}
    \caption[Logistic curve fits to stress-strain curves]{
        Top panel: Logistic curve fit (red) to one stress-strain curve (black).
        $R^2 = 0.9983$.
        Bottom panel: distribution of $R^2$ on all stress-strain curves.
        Mean $R^2 = 0.9980$ (red) with a standard deviation of \num{0.0036}.
    }
    \label{fig:logistic-fit-and-r2-histogram}
\end{figure}

\subsubsection{Label density smoothing}
The labels were smoothed using LDS using Gaussian kernels.
All kernels had a size of 30 and a standard deviation of 3.
The distribution bins were manually set to $(\sigma_{\mathrm{max},\mathrm{min}}, \sigma_{\mathrm{max},\mathrm{max}}, s_{\sigma_\mathrm{max}}) = (0, 15, 0.01) \unit{\mega\pascal}$,
$(E_{\mathrm{max},\mathrm{min}}, E_{\mathrm{max},\mathrm{max}}, s_{E_\mathrm{max}}) = (0, 50, 0.1) \unit{\mega\pascal\per\stretch}$, and \\ $(\gamma_{c,\mathrm{min}}, \gamma_{\mathrm{max},\mathrm{max}}, s_{\gamma_\mathrm{max}}) = (1, 1.5, 0.001) \unit{\stretch}$,
where $s$ is the bin width.
The smoothed distribution is shown in \cref{fig:skin_lds}.

\begin{figure}
    \centering
    \includegraphics[width=\linewidth]{skinstression/images/lds/a.pdf} \\
    \includegraphics[width=\linewidth]{skinstression/images/lds/k.pdf} \\
    \includegraphics[width=\linewidth]{skinstression/images/lds/xc.pdf}
    \caption[Label density smoothed target distributions]{
        Empirical target distribution (red) and label density smoothed (LDS) target distribution (blue) for $\sigma_\mathrm{max}$, $E_\mathrm{max}$, and $\chi_c$.
        LDS aims to fill the gaps between the actual measurements.
        LDS also extrapolates target distributions.
        For all targets, the kernel size was 30 units, and the standard deviation 3 units.
        The bin width were \num{0.01}, \num{0.1}, and \num{0.001} units for $\sigma_\mathrm{max}$, $E_\mathrm{max}$, and $\chi_c$, respectively.
    }
    \label{fig:skin_lds}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% IMAGE QUALITY
%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Image quality}
Presumably, the model will yield erroneous predictions if images of bad quality are provided.
Moreover, the measurement was not always done in the same order, \ie from the lowest to the highest tissue or vice versa.
Therefore, two image quality measurements were explored: Shannon entropy and kurtosis.

The kurtosis of some image stacks were used to validate the image quality by eye, see \cref{fig:skin_kurtosis_depth}.
The entropy of the same image stacks as for kurtosis were used to validate the image quality by eye, see \cref{fig:skin_entropy_depth}.
For reasons explained in \cref{sec:disc_ent_vs_kur}, entropy is further used to choose the top quality images from every stack.

\begin{figure*}
    \centering
    \includegraphics[width=\linewidth]{skinstression/images/kurtosis/8.pdf} \\
    % \includegraphics[width=\linewidth]{skinstression/images/kurtosis/9.pdf} \\
    \includegraphics[width=\linewidth]{skinstression/images/kurtosis/11.pdf} \\
    \includegraphics[width=\linewidth]{skinstression/images/kurtosis/22.pdf} \\
    \includegraphics[width=\linewidth]{skinstression/images/kurtosis/27.pdf} \\
    % \includegraphics[width=\linewidth]{skinstression/images/kurtosis/28.pdf} \\
    \includegraphics[width=\linewidth]{skinstression/images/kurtosis/37.pdf}
    \caption[Kurtosis vs image stack depth]{
        Kurtosis as a function of image stack depth for a representing subset.
        Four images which are equally spaced in physical units are inset.
    }
    \label{fig:skin_kurtosis_depth}
\end{figure*}

\begin{figure*}
    \centering
    \includegraphics[width=\linewidth]{skinstression/images/entropy/8.pdf} \\
    % \includegraphics[width=\linewidth]{skinstression/images/entropy/9.pdf} \\
    \includegraphics[width=\linewidth]{skinstression/images/entropy/11.pdf} \\
    \includegraphics[width=\linewidth]{skinstression/images/entropy/22.pdf} \\
    \includegraphics[width=\linewidth]{skinstression/images/entropy/27.pdf} \\
    % \includegraphics[width=\linewidth]{skinstression/images/entropy/28.pdf} \\
    \includegraphics[width=\linewidth]{skinstression/images/entropy/37.pdf}
    \caption[Shannon entropy vs image stack depth]{
        Normalized Shannon entropy as a function of image stack depth for a representing subset.
        Four images which are equally spaced in physical units are inset.
    }
    \label{fig:skin_entropy_depth}
\end{figure*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% HYPERPARAMETER SEARCH
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Hyperparameter optimization}

The loss curves of the best trials of every search are shown in \cref{fig:skinstression-search-best-loss}
Both training and validation loss show an increase at the learning rate restarts.

\begin{figure*}
    \centering
    \includegraphics[width=0.33\linewidth]{skinstression/images/hyperparameter-search/search-1/best-trial-loss.pdf}
    \includegraphics[width=0.33\linewidth]{skinstression/images/hyperparameter-search/search-2/best-trial-loss.pdf}
    \includegraphics[width=0.33\linewidth]{skinstression/images/hyperparameter-search/search-3/best-trial-loss.pdf}
    \caption[Hyperparameter search the best losses]{
        Successive halving trial 71 of 100 has shown the best loss for search 1.
        Hyperband trial 184 of 300 has shown the best loss for search 2.
        Hyperband trial 73 of 300 has shown the best loss for search 3.
        The training loss (black) and validation loss (light green) are shown.
        The learning rate (orange) restarts explain sudden increase in loss.
    }
    \label{fig:skinstression-search-best-loss}
\end{figure*}

% \subsubsection{Search 1}
% The contour plot is shown in \cref{fig:skinstression-search1-contour}.
% Only the loss curves of the best trial (71) is shown in \cref{fig:skinstression-search1-best-loss}.
% Both training and validation loss show an increase at the learning rate restarts.

% \begin{figure}
%     \centering
%     \includegraphics[]{skinstression/images/hyperparameter-search/search-1/best-trial-loss.pdf}
%     \caption[Best loss curve of search 1]{
%         Successive halving trial 71 of 100 has shown the best loss for search 1.
%         The training loss (black) is followed by the validation loss (light green).
%         The learning rate (orange) restarts explain sudden increase in loss.
%     }
%     \label{fig:skinstression-search1-best-loss}
% \end{figure}

% \begin{figure*}
%     \centering
%     \includegraphics[width=\linewidth]{skinstression/images/hyperparameter-search/search-1/contour.pdf}
%     % \includegraphics[angle=90,width=0.9\textheight, height=\linewidth,keepaspectratio]{skinstression/images/hyperparameter-search/search-1/contour.pdf}
%     \caption[Search 1 contour plot]{
%         Contour plot of search 1.
%         Darker regions denote better results.
%         This contour plot is only constructed from trials which have not been pruned.
%     }
%     \label{fig:skinstression-search1-contour}
% \end{figure*}

% \subsubsection{Search 2}
% The contour plot is shown in \cref{fig:skinstression-search2-contour}.
% Only the loss curves of the best trial (184) is shown in \cref{fig:skinstression-search2-best-loss}.
% Both training and validation loss show an increase at the learning rate restarts.

% \begin{figure}
%     \centering
%     \includegraphics[]{skinstression/images/hyperparameter-search/search-2/best-trial-loss.pdf}
%     \caption[Best loss curve of search 2]{
%         Hyperband trial 184 of 300 has shown the best loss for search 2.
%         The training loss (black) is followed by the validation loss (light green).
%         The learning rate (orange) restarts explain sudden increase in loss.
%     }
%     \label{fig:skinstression-search2-best-loss}
% \end{figure}

% \begin{figure*}
%     \includegraphics[angle=90,width=0.9\textheight, height=\linewidth,keepaspectratio]{skinstression/images/hyperparameter-search/search-2/contour.pdf}
%     \caption[Search 2 contour plot]{
%         Contour plot of search 2.
%         Darker regions denote better results.
%         This contour plot is only constructed from trials which have not been pruned.
%     }
%     \label{fig:skinstression-search2-contour}
% \end{figure*}

% \subsubsection{Search 3}
% The contour plot is shown in \cref{fig:skinstression-search3-contour}.
% Only the loss curves of the best trial (73) is shown in \cref{fig:skinstression-search3-best-loss}.
% The training and validation losses diverge, showing the model overfits.

% \begin{figure}
%     \centering
%     \includegraphics[]{skinstression/images/hyperparameter-search/search-3/best-trial-loss.pdf}
%     \caption[Best loss curve of search 3]{
%         Hyperband trial 73 of 300 has shown the best loss for search 3.
%         The training loss (black) and the validation loss (light green) diverge.
%         The learning rate (orange).
%         The trial was pruned at epoch 100.
%     }
%     \label{fig:skinstression-search3-best-loss}
% \end{figure}

% \begin{figure*}
%     \centering
%     \includegraphics[angle=90,width=0.9\textheight, height=\linewidth,keepaspectratio]{skinstression/images/hyperparameter-search/search-3/contour.pdf}
%     \caption[Search 3 contour plot]{
%         Contour plot of search 3.
%         Darker regions denote better results.
%         This contour plot is only constructed from trials which have not been pruned.
%     }
%     \label{fig:skinstression-search3-contour}
% \end{figure*}

%%%%%%%%%%%%%%%%%%
% TRAINING
%%%%%%%%%%%%%%%%%%
\subsection{Training}
Training was done on the best performing set of hyperparameters, which was found by search 1.
Search 1 yielded the lowest validation loss.
The corresponding hyperparameters in \cref{tab:conf_skin_final} were used for further training.

\begin{margintable}
    \centering
    \caption[Skinstression configuration]{
        Skinstression configuration used during training.
        Parameters are ordered by their importance, calculated with fANOVA.
        LR, WD, and BS are learning rate, weight decay and batch size, respectively.
    }
    \label{tab:conf_skin_final}
    \begin{tabular}{l c c c c c c}
        \toprule
        Param.               & Value         & Imp. \\
        \midrule
        {LR}                 & 0.00747       & 0.41 \\
        {$T_0$}              & 145           & 0.24 \\
        {WD}                 & \num{2.97e-5} & 0.22 \\
        {$n_\mathrm{nodes}$} & 64            & 0.08 \\
        {$T_\mathrm{mult}$}  & 2             & 0.05 \\
        {BS}                 & 16            & 0.00 \\
        \bottomrule
    \end{tabular}
\end{margintable}

Three trainings were performed.
For every training, the 10, 20, and 30 images of every stack with the highest entropy were selected to exclude any noisy images.
Also, using the 20 best images of every stack, the model is trained without scaling of the original image.
The loss curves are shown in \cref{fig:skinstression-training}.
The lowest validation losses are shown in \cref{tab:skin_train_102030}.
Overall, the model trained with 20 images shows the lowest total loss.
This model will be used during testing.

To verify performance of training, the stress-strain curves of a random training batch are plotted with the raw data in \cref{fig:skinstression-train-logistic-curves}.
For this batch, $\overline{R^2} = \num{0.75}$ (SE \num{0.13}).


\begin{figure*}
    \centering
    \includegraphics[width=0.48\linewidth]{skinstression/images/training/Training_10_images.pdf}
    \includegraphics[width=0.48\linewidth]{skinstression/images/training/Training_20_images.pdf} \\
    \includegraphics[width=0.48\linewidth]{skinstression/images/training/Training_30_images.pdf}
    \includegraphics[width=0.48\linewidth]{skinstression/images/training/Training_at_1X_zoom.pdf}
    \caption[Training losses]{
        Training losses when using 10, 20, and 30 images as well as a training using 20 images, but with unscaled images.
        The training loss (black) is followed by the validation loss (light green).
        The learning rate (orange) restarts explain sudden increase in loss.
    }
    \label{fig:skinstression-training}
\end{figure*}

\begin{margintable}
    \centering
    \caption[The lowest validation loss per $N_\mathrm{best}$ images]{
        The lowest validation loss per $N_\mathrm{best}$ images.
        The training using 20 images has the lowest validation loss.
        * denotes training without rescaling.
    }
    \label{tab:skin_train_102030}
    \begin{tabular}{S[table-align-text-post=false, table-format=3.0] S[table-format=1.4]}
        \toprule
        {\# Images}  & {Validation loss} \\
        \midrule
        10           & 0.0097            \\
        \bfseries 20 & \bfseries 0.0035  \\
        20*          & 0.27              \\
        30           & 0.0040            \\
        \bottomrule
    \end{tabular}
\end{margintable}

\subsection{Testing}
The results of the best performing images in the test set are shown in \cref{fig:skinstression-test}.
The higher $R^2$, the better the performance.
Over the best performing images of every sample, a low $\overline{R^2} = \num{-0.36}$ (SE \num{0.60}).

The performance difference between the training and test set is significant.
The donors of the test set are both male and female with ages comparable to the training set (see \cref{subsec:results_participants}).
However, most samples of the test set originate from the same person.
If the skin of this donor exhibits other behavior, it might be difficult for the AI to predict well.

\begin{figure*}
    \centering
    \includegraphics[width=0.24\linewidth]{skinstression/images/testing/sample_51_11.pdf}
    \includegraphics[width=0.24\linewidth]{skinstression/images/testing/sample_52_15.pdf}
    \includegraphics[width=0.24\linewidth]{skinstression/images/testing/sample_53_12.pdf}
    \includegraphics[width=0.24\linewidth]{skinstression/images/testing/sample_54_17.pdf} \\
    \includegraphics[width=0.24\linewidth]{skinstression/images/testing/sample_55_10.pdf}
    \includegraphics[width=0.24\linewidth]{skinstression/images/testing/sample_56_9.pdf}
    \includegraphics[width=0.24\linewidth]{skinstression/images/testing/sample_57_19.pdf}
    \includegraphics[width=0.24\linewidth]{skinstression/images/testing/sample_58_17.pdf} \\
    \includegraphics[width=0.24\linewidth]{skinstression/images/testing/sample_59_16.pdf}
    \includegraphics[width=0.24\linewidth]{skinstression/images/testing/sample_60_10.pdf}
    \includegraphics[width=0.24\linewidth]{skinstression/images/testing/sample_61_18.pdf}
    \caption[Test results]{
        Results of the best performing image per sample are shown.
        Performance is quantified by $R^2$.
    }
    \label{fig:skinstression-test}
\end{figure*}

\subsection{Model specification}
The foundational neural network is described in \cref{fig:model}.
The model with the lowest validation loss was chosen as final model.
It accepts a batch of images as input and outputs a vector $(i, \sigma_\mathrm{max}, E_\mathrm{max}, \gamma_c)$,
where $i$ denotes the $i$th image of the batch.

\subsection{Usability}
The prediction AI may be used for two purposes.
One purpose is to skip the mechanical measurement on skin tissue and immediately get an estimation of stretch properties.
Another is to match stretch information to physical features present in the collagen fiber networks.
The model should not be used as validation for mechanical measurements, as it is trained and tested on a small dataset.

Input data should be assessed on quality.
A measure of quality is Shannon entropy, which is used in this study.
However, the model may benefit from other quality measures.
The user should experiment what measure works best.
The application does allow to only select the top $N_\mathrm{best}$ images.

The model only accepts batches of two-dimensional $500 \times 500\,\unit{px}$ images.
Currently, the user should separate any higher-dimensional data and crop \qty{0.2}{mpp} images to fit the model.

\subsection{Explainability}

\subsubsection{Occlusion}
Algorithmically occluded images have been presented to the model to obtain attributions at the pixel level.
For a summary of the test set, they are shown in blended heatmaps in \cref{fig:skin_occlusion}.
\cref{fig:skin_occlusion_53} shows attribution maps for all test images of sample 53.

Attributions appear to coincide with collagen fibers.
This is important, as the abundance of collagen is hypothesized to relate to the stretch properties.
It is unclear how positive and negative attributions give insight into the prediction of stretch properties.
It is important to note that attribution maps belonging to the best performing predictions give the most appropriate insight into the AI reasoning.

The heatmaps give limited insight into the performance errors between samples across the test set or images within a sample.
There is no clear relation between the attribution mean and/or standard deviation and $R^2$.

% \begin{figure*}
%     \ContinuedFloat
%     \centering
%     \includegraphics[width=\linewidth]{skinstression/images/explainability/occlusion/0.pdf} \\
%     \raggedleft Continued on next page.
% \end{figure*}

\subsubsection{Adversarial attack}
\Cref{fig:attack_occlusion} shows attribution maps for all outputs to compare attacked images with the original image.
\Cref{fig:pred_output_attack} shows the predicted logistic curves for the attacked images and the original image.
These results show that artificially filling holes increases the stiffness and resistance, while adding holes decreases stiffness and resistance.
\begin{marginfigure}[-5\baselineskip]
    \includegraphics{skinstression/images/attack/holes.pdf}
    \caption[Prediction output after hole attack]{
        Prediction output after hole attack.
    }
    \label{fig:pred_output_attack}
\end{marginfigure}

\begin{figure*}
    % \ContinuedFloat
    \centering
    \includegraphics[width=\linewidth]{skinstression/images/explainability/occlusion/summary_test_0.pdf}
    \caption[Original image and attribution heat maps]{
        Original image and attribution heat maps.
        Attributions are blended with the original image.
        Attributions were calculated using $20\times 20\unit{px}$ occlusion.
        Color scale is from \numrange{-3}{3} units, and is linear from \qtyrange{-0.1}{0.1}{\mega\pascal}, \qtyrange{-0.1}{0.1}{\mega\pascal\per\stretch}, and \qtyrange{-0.001}{0.001}{\stretch}.
        Mean $\pm$ standard deviation are inset.
        Zoom in the digital version for details.
    }
    \label{fig:skin_occlusion}
\end{figure*}


\begin{figure*}
    \ContinuedFloat
    \centering
    \includegraphics[width=\linewidth]{skinstression/images/explainability/occlusion/summary_53_0.pdf} \\
    \raggedleft Continued on next page.
\end{figure*}
\begin{figure*}
    % \ContinuedFloat
    \centering
    \includegraphics[width=\linewidth]{skinstression/images/explainability/occlusion/summary_53_1.pdf}
    \caption[Original image and attribution heat maps for sample 53]{
        Original image and attribution heat maps for sample 53.
        Attributions are blended with the original image.
        Attributions were calculated using $20\times 20\unit{px}$ occlusion.
        Green and red show which parts attribute to under- and overestimations, compared to output calculated from an unoccluded image.
        Color scale is from \numrange{-1.5}{1.5} units, and is linear from \qtyrange{-0.1}{0.1}{\mega\pascal}, \qtyrange{-0.1}{0.1}{\mega\pascal\per\stretch}, and \qtyrange{-0.001}{0.001}{\stretch}.
        Mean $\pm$ standard deviation are inset.
        Zoom in the digital version for details.
    }
    \label{fig:skin_occlusion_53}
\end{figure*}

\begin{figure*}
    \centering
    \includegraphics[width=\linewidth]{skinstression/images/attack/attack-viz.pdf} \\
    \includegraphics[width=\linewidth]{skinstression/images/attack/holes-occlusion-0.pdf} \\
    \includegraphics[width=\linewidth]{skinstression/images/attack/holes-occlusion-1.pdf} \\
    \includegraphics[width=\linewidth]{skinstression/images/attack/holes-occlusion-2.pdf}
    \caption[Occlusion on attacked image]{
        Top row shows a visualization of the two attacks.
        The middle image has holes filled with white.
        The right image has duplicates of one hole.
        The next rows show occlusion attribution maps for all outputs.
        Color scales are equal to \cref{fig:skin_occlusion_53}.
    }
    \label{fig:attack_occlusion}
\end{figure*}

